<?php

namespace App\Http\Controllers;
ini_set('memory_limit', '-1');
ini_set('max_execution_time', '10000');
use Illuminate\Http\Request;
use Notification;
use Validator;
use Illuminate\Support\Facades\Mail;
use App\Mail\WeaklyReport;
use App\QmSheet;
use App\QmSheetSubParameter;
use Illuminate\Support\Facades\DB;
use Excel;
use App\Exports\CollectionExport;
use Illuminate\Support\Facades\Storage;
use App\SendWeeklyFile;
use App\Holiday;
use App\Auditcycle;
use App\Audit;
use App\MonthTarget;
use Illuminate\Database\Eloquent\Builder;

class TestController extends Controller
{
    public function test_execl(Request $request){
        
        if($request->isMethod('post')){

            /* $request->report->store('storage/app/logos');
            die; */
            
            $request->report->store("raw_data_dump_file");

             $file_name = $request->report->hashName();

            echo $file_name;
            die;
            $entry = new SendWeeklyFile;
            $entry->file_details == "ibcc_prepaid file month feb week 1";

            $entry->file_name = $file_name;
            $entry->sent_status = 1;
            $entry->save();
            //$corelPath = Storage::url('raw_data_dump_file/').$file_name;
            $file_name = "adfkkdfl.id";
            if ($request->hasFile('report')) {
                $file_name =  $request->file('report')->getClientOriginalName();
            }

            /* die;
            $file_name = 'ogml2.xls'; */


            $corelPath = public_path() . '/weekly_reports/'.$file_name;
            //$to_emails = ["shailendra.kumar@qdegrees.com"];
            //$cc_emails = ["shailendra1994@hotmail.com"];
            // $to_emails = ["shailendra.kumar@qdegrees.com","atul.singh@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com","samarjeet.singh@qdegrees.com"];
            
            
            if($file_name == 'cnc.xls') {
                $client = 'Kalpana';
                $process = 'CNC';
                $qtl = 'Atul';
                $subject = "Weekly Report For CNC for July'21";

                $to_emails = ["kalpana.patel@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","shafeeq.mansoori@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'cpm.xls'){
                $client = 'Kalpana';
                $process = 'CPM';
                $qtl = 'Atul';
                $subject = "Weekly Report For CPM for July'21";
                $to_emails = ["kalpana.patel@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","shafeeq.mansoori@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
                
            } else if($file_name == 'cmt.xls'){
                $client = 'Rupali';
                $process = 'CMT';
                $qtl = 'Atul';
                $subject = "Weekly Report For CMT for July'21";
                $to_emails = ["rupali.maniar@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'ibcc_postpaid.xls'){
                $client = 'Rupali';
                $process = 'IBCC Postpaid';
                $qtl = 'Atul';
                $subject = "Weekly Report For IBCC Postpaid for July'21";
                $to_emails = ["rupali.maniar@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'ibcc_prepaid.xls'){
                $client = 'Sylvia';
                $process = 'IBCC Prepaid';
                $qtl = 'Atul';
                $subject = "Weekly Report For IBCC Prepaid for July'21";
                $to_emails = ["sylvia.choudhury@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'nflc.xls'){
                $client = 'Vinita';
                $process = 'NFLC';
                $qtl = 'Atul';
                $subject = "Weekly Report For NFLC for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'OBCS.xls'){
                $client = 'Kalpana';
                $process = 'OBCC';
                $qtl = 'Atul';
                $subject = "Weekly Report For OBCC for July'21";
                $to_emails = ["kalpana.patel@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","shafeeq.mansoori@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'ogm.xls'){
                $client = 'Vinita';
                $process = 'OGM L1';
                $qtl = 'Atul';
                $subject = "Weekly Report For OGM for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'ogml2.xls'){
                $client = 'Vinita';
                $process = 'OGM L2';
                $qtl = 'Atul';
                $subject = "Weekly Report For OGML2 for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'service_plus.xls'){
                $client = 'Rupali';
                $process = 'Service Plus';
                $qtl = 'Atul';
                $subject = "Weekly Report For Service Plus for July'21";
                $to_emails = ["rupali.maniar@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];

            } else if($file_name == 'srd.xls'){
                $client = 'Vinita';
                $process = 'SRD';
                $qtl = 'Atul';
                $subject = "Weekly Report For SRD for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'wcom.xls'){
                $client = 'Vinita';
                $process = 'WCOM';
                $qtl = 'Atul';
                $subject = "Weekly Report For W-Com for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else if($file_name == 'webchat.xls'){
                $client = 'Vinita';
                $process = 'Web Chat';
                $qtl = 'Atul';
                $subject = "Weekly Report For Web Chat for July'21";
                $to_emails = ["vanita.almeida@vodafoneidea.com"];
                $cc_emails = ["jaya.shaikh@vodafoneidea.com","akshita.jain@qdegrees.com","rahul.singh01@qdegrees.com","atul.singh@qdegrees.com","samarjeet.singh@qdegrees.com","ashish.guwalani@qdegrees.com","sb@qdegrees.com","shailendra.kumar@qdegrees.com"];
            } else {
                echo "file not metch";
                die;
            }
           


            //$subject = "Weekly Report For IBCC Prepaid for July'21 week 4";
            //$subject = "Weekly Report For IBCC Postpaid for July'21 week 4";
            //$subject = "Weekly Report For OBCC for July'21 week 4";
            //$subject = "Weekly Report For CNC for July'21 week 4";
            //$subject = "Weekly Report For Web Chat for July'21 week 4";
            //$subject = "Weekly Report For W-Com for July'21 week 4";
            //$subject = "Weekly Report For SRD for July'21 week 4";
            //$subject = "Weekly Report For OGML2 for July'21 week 4";
            //$subject = "Weekly Report For Service Plus for July'21 week 4";
            //$subject = "Weekly Report For OGM for July'21 week 4";
            //$subject = "Weekly Report For NFLC for July'21 week 4";
            //$subject = "Weekly Report For CPM for July'21 week 4";
            
            if($file_name == "adfkkdfl.id"){
                echo "file name not match";
                die;
            } else {
                
               /*  Mail::to($to_emails)->cc($cc_emails)->send(new WeaklyReport(
                    [
                    'partner_name'=>'All',
                    'file'=>$corelPath,
                    'subject'=>$subject,
                    'client'=>$client,
                    'process'=>$process,
                    'qtl'=>$qtl,
                    'url'=>'https://simpliq.qdegrees.com/'
                    ]
                )); */
            }
            
        } else {
            return view('test.test');
        }
        
        
    }
    public function ogm_weekly_report(){
        
        $audit_cyle_data = Auditcycle::where('process_id',26)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);
        $day = date('d', $timestamp);
        if($day == 27 || $day >25){
            $month = $previous_cycle;
        }else {
            $month = $current_cycle;
        }
        
        $client_id = 3;
        $process_id = 26;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total



            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="ogm.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        //$file_link = readfile($file);

        //print_r($file_get_contents($file));
        //echo $test;
        
        echo $test;
        die;
    } 
 
    public function cpm_weekly_report(){
        
        $audit_cyle_data = Auditcycle::where('process_id',29)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');

        $client_id = 3;
        $process_id = 29;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

             // partner wise score
             $t_week1target_p = 0;
             $t_week2target_p = 0;
             $t_week3target_p = 0;
             $t_week4target_p = 0;
             $t_weekmtdtarget_p = 0;
 
             $t_week1achieve_p = 0;
             $t_week2achieve_p = 0;
             $t_week3achieve_p = 0;
             $t_week4achieve_p = 0;
             $t_weekmtdachieve_p = 0;
 
             $t_week1fatalcount_p = 0;
             $t_week2fatalcount_p = 0;
             $t_week3fatalcount_p = 0;
             $t_week4fatalcount_p = 0;
             $t_weekmtdfatalcount_p = 0;
             
             $t_week1scored_p = 0;
             $t_week2scored_p = 0;
             $t_week3scored_p = 0;
             $t_week4scored_p = 0;
             $t_weekmtdscored_p = 0;
 
             $t_week1scorable_p = 0;
             $t_week2scorable_p = 0;
             $t_week3scorable_p = 0;
             $t_week4scorable_p = 0;
             $t_weekmtdscorable_p = 0;
             
             $row_count = 0;
             $array_size = sizeof($interim_data);
             $partner_old = "";
             // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total


            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

             // Partner wise total
             $partner_new = $row ['name'];
             if($partner_old == ""){
                 $partner_old = $row ['name'];
             }
 
             if($partner_old != $partner_new ){
 
                 
                 $test .= "<tr>
                 <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                 
 
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                 
                     if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                     
                     $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                 
                     if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                     
                     $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>";
                     if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                 
                     
                 $test .= "</td>
                         <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                     if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                         $test .= "0 %";
                     else 
                     $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                 
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                     if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                         $test .= "0 %";
                     else 
                     $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                     
                     $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>";
                     if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                         $test .= "0 %";
                     else 
                     $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                     
                     
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                     if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                     
                 $test .= "</td>
                         <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                     if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                         $test .= "0 %";
                     else 
                     $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                     
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>";
                     if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                     
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                     if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                 
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                     if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                     
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>";
                     if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                     
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                     if(($t_weekmtdtarget_p - $total_target) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                 
                 $test .= "</td>
                     <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                     if(($t_weekmtdscorable_p - $total_scorable) == 0)
                         $test .= "0 %";
                     else 
                         $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                 
                 $test .= "</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                 <td style='border: 1px solid black;border-collapse: collapse;'>";
                     if(($t_weekmtdachieve_p - $total_achievment) == 0)
                         $test .= "0 %";
                     else
                         $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                     
                 $test .= "</td>
 
                 </tr>";
 
                 $t_week1target_p = $row ['eq_audit_target_w1'];
                 
                 $t_week2target_p = $row ['eq_audit_target_w2'];
                 $t_week3target_p = $row ['eq_audit_target_w3'];
                 $t_week4target_p = $row ['eq_audit_target_w4'];
                 $t_weekmtdtarget_p = $total_target;
 
                 $t_week1achieve_p = $row ['achieve_first_week'];
                 $t_week2achieve_p =  $row ['achieve_second_week'];
                 $t_week3achieve_p = $row ['achieve_third_week'];
                 $t_week4achieve_p = $row ['achieve_fourth_week'];
                 $t_weekmtdachieve_p = $total_achievment;
 
                 $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                 $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                 $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                 $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                 $t_weekmtdfatalcount_p = $total_count_fatal;
                 
                 $t_week1scored_p = $row ['total_scored_first_week'];
                 $t_week2scored_p = $row ['total_scored_second_week'];
                 $t_week3scored_p = $row ['total_scored_third_week'];
                 $t_week4scored_p = $row ['total_scored_fourth_week'];
                 $t_weekmtdscored_p = $total_scored;
 
                 $t_week1scorable_p = $row ['total_scorable_first_week'];
                 $t_week2scorable_p = $row ['total_scorable_second_week'];
                 $t_week3scorable_p = $row ['total_scorable_third_week'];
                 $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                 $t_weekmtdscorable_p = $total_scorable;
             }
 
             // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score


        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="cpm.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;

            
        
    } 

    public function service_plus_weekly_report(){
        
        $audit_cyle_data = Auditcycle::where('process_id',11)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }

        $client_id = 3;
        $process_id = 11;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

            

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score

        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="service_plus.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;

            
        
    }

    public function ogml2_weekly_report(){
        
        $audit_cyle_data = Auditcycle::where('process_id',30)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        

        $client_id = 3;
        $process_id = 30;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score

        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="ogml2.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;

            
        
    }

    public function ibcc_prepaid(){
        
        $audit_cyle_data = Auditcycle::where('process_id',5)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $previous_cycle;         
        }

        $process_id = 5;
        $client_id = 3;
        $partner_id = "%";
        $lob = 'Prepaid';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        

        $final_data = DB::select("
        select count(a.id) as achieve_week,sum(case when (a.is_critical = 1) then 1 else 0 end) as count_fatal_week,
        sum(ar.score) as total_scored_week,
        sum(ar.after_audit_weight) as total_scorable_week,
        p.name,c.name as client_name, w.week_number,m.*    
        from month_targets m inner join partners p on m.partner_id = p.id 
                inner join clients c on m.client_id = c.id 
                inner join week_definitions w on m.month_of_target = w.month 
        inner join audits a  on a.client_id=3 and a.partner_id = m.partner_id and a.process_id=m.process_id
        inner join raw_data r on a.raw_data_id = r.id and r.client_id = m.client_id 
        inner join audit_results ar on ar.audit_id=a.id
                        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location 
                        and r.circle like m.circle          
            and m.process_id = $process_id 
            and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id
            
            
            where a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)
            
        group by m.id,c.id,w.id,w.week_number,
        @sum_scr:=0
        ");


        print_r($final_data);
        die;




/*         $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
         */
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total
            
            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="ibcc_prepaid.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function ibcc_postpaid(){
        
        $audit_cyle_data = Auditcycle::where('process_id',5)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }

        $process_id = 5;
        $client_id = 3;
        $partner_id = "%";
        $lob = 'Postpaid';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total


            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="ibcc_postpaid.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }
    
    public function web_chat(){
        
        $audit_cyle_data = Auditcycle::where('process_id',8)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 8;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total
            
            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="webchat.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function nflc(){
        
        $audit_cyle_data = Auditcycle::where('process_id',9)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 9;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            
            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="nflc.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function cnc(){
        
        $audit_cyle_data = Auditcycle::where('process_id',10)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 10;
        $client_id = 9;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        
        
        foreach($interim_data as $row){
            

            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total


            

            
            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total
             

            // normal list
                $test .= "<tr>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
                
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
                
                    if($row ['eq_audit_target_w1'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
                
                    if($row ['total_scorable_first_week'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if($row ['achieve_first_week'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                    if($row ['eq_audit_target_w2'] == 0)
                        $test .= "0 %";
                    else 
                    $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                    if($row ['total_scorable_second_week'] == 0)
                        $test .= "0 %";
                    else 
                    $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if($row ['achieve_second_week'] == 0)
                        $test .= "0 %";
                    else 
                    $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                    if($row ['eq_audit_target_w3'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                    if($row ['total_scorable_third_week'] == 0)
                        $test .= "0 %";
                    else 
                    $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if($row ['achieve_third_week'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                    if($row ['eq_audit_target_w4'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                    if($row ['total_scorable_fourth_week'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if($row ['achieve_fourth_week'] == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                    if($total_target == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($total_achievment/$total_target)*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                    if($total_scorable == 0)
                        $test .= "0 %";
                    else 
                        $test .= round(($total_scored/$total_scorable)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if($total_achievment == 0)
                        $test .= "0 %";
                    else
                        $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                    
                $test .= "</td>

                </tr>"; 

                // partner wise score


                if($row_count == $array_size){

                    $test .= "<tr>
                    <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
                    
                    
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
                    
                        if($t_week1target_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                        
                        $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
                    
                        if($t_week1scorable_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                        
                        $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>";
                        if($t_week1achieve_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
                    
                        
                    $test .= "</td>
                            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                        if($t_week2target_p == 0)
                            $test .= "0 %";
                        else 
                        $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
                    
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                        if($t_week2scorable_p == 0)
                            $test .= "0 %";
                        else 
                        $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                        
                        $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                        if($t_week2achieve_p == 0)
                            $test .= "0 %";
                        else 
                        $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                        
                        
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                        if($t_week3target_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                        
                    $test .= "</td>
                            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                        if($t_week3scorable_p == 0)
                            $test .= "0 %";
                        else 
                        $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                        
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                        if($t_week3achieve_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                        
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                        if($t_week4target_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
                    
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                        if($t_week4scorable_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                        
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                        if($t_week4achieve_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                        
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                        if($t_weekmtdtarget_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
                    
                    $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                        if($t_weekmtdscorable_p == 0)
                            $test .= "0 %";
                        else 
                            $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                        if($t_weekmtdachieve_p == 0)
                            $test .= "0 %";
                        else
                            $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                        
                    $test .= "</td>
    
                    </tr>";
    
                    
                }

                $partner_old = $row ['name'];
                // Partner wise score


            
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="cnc.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function srd(){
        
        $audit_cyle_data = Auditcycle::where('process_id',6)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 6;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            
            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

             // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="srd.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function obcs(){
        
        $audit_cyle_data = Auditcycle::where('process_id',25)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;        
        }
        //$month = date('m/Y');
        $process_id = 25;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total


            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            // normal list
            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score


        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="OBCS.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function wcom(){
        
        $audit_cyle_data = Auditcycle::where('process_id',7)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 7;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.info_1 like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="wcom.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function cmt(){
        
        $audit_cyle_data = Auditcycle::where('process_id',27)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        //$month = date('m/Y');
        $process_id = 27;
        $client_id = 3;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle and r.brand_name like m.brand_name   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score
        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        
        
        $file="cmt.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test;
        die;
    }

    public function interim_report_cluster(){


        $cluster = DB::select("select u.id, u.name from cluster_client_mappings c 
            inner join users u on c.user_id = u.id group by c.user_id");
        
        


        if(1){
 
            
            $month = "04/2021";
            $cluster_id = 63;
            $clients = ClusterClientMapping::select('Client_id')->where('user_id',$cluster_id)->get();
            $processes = ProcessMapping::select('process_id')->where('client_id',$cluster_id)->get();
            $partners = PartnerMapping::select('partner_id')->where('client_id',$cluster_id)->get();
            $lobs = LobMapping::select('lob')->where('user_id',$cluster_id)->get();

            $process_array = array();
            foreach($processes as $value){
                array_push($process_array, $value['process_id']);
            }

            $lob_array = array();
            foreach($lobs as $value){
                array_push($lob_array, "'".$value['lob']."'");
            }

            $partner_array = array();
            foreach($partners as $value){
                array_push($partner_array, $value['partner_id']);
            }

            $client_array = array();
            foreach($clients as $value){
                array_push($client_array, $value['Client_id']);
            }
            
            $process_list = implode(",",$process_array);
            $partners_list = implode(",",$partner_array);
            $lobs_list = implode(",",$lob_array);
            $clients_list = implode(",",$client_array);

            /* print_r($lobs_list);
            die; */
            $sheet_info = QmSheet::select('id')->whereIn('client_id',$clients)->whereIn('process_id',$processes)->get();
            
            $paramter_count  = QmSheetSubParameter::whereIn('qm_sheet_id',$sheet_info)->count();
            
            /* print_r($paramter_count);
            die; */
                $final_data = DB::select("
                select p.name,c.name as client_name, w.week_number,m.*,


                (select count(b.id) from rebuttals b inner join raw_data r on b.raw_data_id = r.id
                inner join audits a on b.audit_id = a.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date <= w.end_date) as rebuttal,
                
                (select count(b.id) from rebuttals b inner join raw_data r on b.raw_data_id = r.id
                inner join audits a on b.audit_id = a.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date <= w.end_date and b.status = 1) as rebuttal_accept,

                (select count(b.id) from rebuttals b inner join raw_data r on b.raw_data_id = r.id
                inner join audits a on b.audit_id = a.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date <= w.end_date and b.status = 2) as rebuttal_reject,

                (select count(b.id) from rebuttals b inner join raw_data r on b.raw_data_id = r.id
                inner join audits a on b.audit_id = a.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date <= w.end_date and b.status = 0) as rebuttal_process,

                (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

                (select sum(a.overall_score) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_first_week,



                (select sum(p.with_fatal_score) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and a.is_critical = 0 and
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_fatal_first_week,

                (select sum(p.temp_weight) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as scored_first_week,


                (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

                (select sum(a.overall_score) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_second_week,

                (select sum(p.with_fatal_score) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and a.is_critical = 0 and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_fatal_second_week,

                (select sum(p.temp_weight) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as scored_second_week,




                (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

                (select sum(a.overall_score) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_third_week,

                (select sum(p.with_fatal_score) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and a.is_critical = 0 and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_fatal_third_week,

                (select sum(p.temp_weight) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as scored_third_week,




                (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

                (select sum(a.overall_score) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_fourth_week,

                (select sum(p.with_fatal_score) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and a.is_critical = 0 and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as score_fatal_fourth_week,

                (select sum(p.temp_weight) from audit_parameter_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
                and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob = m.lob and r.location = m.location and 
                r.brand_name = m.brand_name and r.circle = m.circle and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as scored_fourth_week



                from month_targets m inner join partners p on m.partner_id = p.id
                inner join clients c on m.client_id = c.id 
                inner join week_definitions w on m.month_of_target = w.month where m.process_id In ($process_list) and m.lob In ($lobs_list) and m.partner_id In ($partners_list) and m.client_id In ($clients_list) and m.month_of_target = '$month' order by p.name");
            
            



          //  echo $month;
          $interim_data = [];  
          foreach($final_data as $value){
            if(isset($interim_data[$value->id])){
                if($value->week_number == 1){
                    /* echo "hii";
                    dd(); */
                    $interim_data[$value->id]['score_first_week'] = $value->score_first_week;
                    $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                    $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                    $interim_data[$value->id]['score_fatal_first_week'] = $value->score_fatal_first_week;
                    $interim_data[$value->id]['scored_first_week'] = $value->scored_first_week;
                
                }  else if($value->week_number == 2){

                    $interim_data[$value->id]['score_second_week'] = $value->score_second_week;
                    $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                    $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                    $interim_data[$value->id]['score_fatal_second_week'] = $value->score_fatal_second_week;
                    $interim_data[$value->id]['scored_second_week'] = $value->scored_second_week;
                
                } else if($value->week_number == 3){

                    $interim_data[$value->id]['score_third_week'] = $value->score_third_week;
                    $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                    $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                    $interim_data[$value->id]['score_fatal_third_week'] = $value->score_fatal_third_week;
                    $interim_data[$value->id]['scored_third_week'] = $value->scored_third_week;
                
                } else {
                    $interim_data[$value->id]['score_fourth_week'] = $value->score_fourth_week;
                    $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                    $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                    $interim_data[$value->id]['score_fatal_fourth_week'] = $value->score_fatal_fourth_week;
                    $interim_data[$value->id]['scored_fourth_week'] = $value->scored_fourth_week;
                
                }
                
            }
            else {
                $interim_data[$value->id]['client_name'] = $value->client_name;
                $interim_data[$value->id]['name'] = $value->name;
                $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
                $interim_data[$value->id]['lob'] = $value->lob;
                $interim_data[$value->id]['zone'] = $value->zone;
                $interim_data[$value->id]['location'] = $value->location;
                $interim_data[$value->id]['brand_name'] = $value->brand_name;
                $interim_data[$value->id]['circle'] = $value->circle;
                $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
                $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
                $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
                $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process;

                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['score_first_week'] = $value->score_first_week;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['score_fatal_first_week'] = $value->score_fatal_first_week;
                $interim_data[$value->id]['scored_first_week'] = $value->scored_first_week;

                $interim_data[$value->id]['score_second_week'] = $value->score_second_week;
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['score_fatal_second_week'] = $value->score_fatal_second_week;
                $interim_data[$value->id]['scored_second_week'] = $value->scored_second_week;

                $interim_data[$value->id]['score_third_week'] = $value->score_third_week;
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['score_fatal_third_week'] = $value->score_fatal_third_week;
                $interim_data[$value->id]['scored_third_week'] = $value->scored_third_week;

                $interim_data[$value->id]['score_fourth_week'] = $value->score_fourth_week;
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['score_fatal_fourth_week'] = $value->score_fatal_fourth_week;
                $interim_data[$value->id]['scored_fourth_week'] = $value->scored_fourth_week;

            }
          }

        /* echo "<pre>";
        print_r($interim_data);
        dd(); */

        

            
            return view('reports.interim_report',compact('interim_data','paramter_count','cluster'));

        }
        else {
               

            $interim_data = 0;
            return view('reports.interim_report',compact('interim_data','cluster'));
        }
    }

    public function skipHoliday_1(){
        return view('holiday.edit');
    }

    public function skipHoliday(Request $request)
    { 

        /* $date = strtotime(date("Y-m-d H:i:s"));
        $holiday = 2;
        $delay1 = 2;
        $delay2 = 2; */

        $date = strtotime($request->date);
        $holiday = $request->holiday;
        $delay1 = $request->delay1;
        $delay2 = $request->delay2;
        if($date)
        {
            
            /* $pieces = explode(" ", $date);
            echo $pieces[0];
            die; */
            $array = [];
            $national_holidays = Holiday::select('holiday_date')->get();
            foreach($national_holidays as $values){
                array_push($array,$values->holiday_date);
            }
            
            for ($i=1; $i < $delay1+1; $i++) {

               
                $date1 = strtotime(date("Y-m-d H:i:s",strtotime("+$i day", "$date")));
                
                $day = date('D', $date1);
                
                $sun =0;
                $sat = 0;
                if ($holiday=='1' && $day=="Sun") {
                    $sun =1;
                    $delay1 += 1;
                    
                }
                if ($holiday=='2' && $day=="Sat") {
                    $sun =1;
                    $sat = 1;
                    $delay1 += 2;
                    
                }

                if(gettype(array_search(date('Y-m-d',$date1),$array)) == 'integer'){
                    if($sun == 1 || $sat == 1){

                    }else {
                        $delay1 += 1;
                    }
                }
               
                

            }

                /* $date1 = strtotime(date("Y-m-d H:i:s",strtotime("+$i day", "$date")));
                $day = date('D', $date1);
                if ($holiday=='1' && $day=="Sun") {
                    $delay1 += 1;
                    echo "hii";
                dd();
                }
                if ($holiday=='2' && $day=="Sat") {
                    $delay1 += 2;
                    
                } */
            

        $date2 = strtotime(date("Y-m-d H:i:s",strtotime("+$delay1 day", "$date")));

        for ($i=1; $i < $delay2+1; $i++) { 
            $date3 = strtotime(date("Y-m-d H:i:s",strtotime("+$i day", "$date2")));
            $day = date('D', $date3);
            $sun =0;
            $sat = 0;
            if ($holiday=='1' && $day=="Sun") {
                $delay2 += 1;
                
            }
            if ($holiday=='2' && $day=="Sat") {
                $delay2 += 2;
                
            }

            if(gettype(array_search(date('Y-m-d',$date3),$array)) == 'integer'){
                if($sun == 1 || $sat == 1){

                }else {
                    $delay2 += 1;
                }
            }

        }

        $date4 = date("Y-m-d H:i:s",strtotime("+$delay1 day", "$date"));
        $date5 = date("Y-m-d H:i:s",strtotime("+$delay2 day", "$date2"));

        return $audit_date = array($date4,$date5);
        }
    }

    public function batch_download(){
        echo "
        <a href='".Storage::url('raw_data_dump_file/')."JH8w2MZXCDDHh8pwCTcXycLXtlyUZEN6nFNoUQYj.xlsx'>Download Sheet</a>";
    }
    public function message_api_testing(){
        $mobile = "8107677968";
        $otp = "212454";
        $msg = "Your OTP to login Tata Pravesh Vardhak Application from QDegrees is ";
        $this->sendSms($mobile,$otp,$msg);
    }

    public function sendSms($mobile,$msg,$otp_code) {
        $message=$otp_code." ".$msg;
        $xml_data ='<?xml version="1.0"?>
                    <smslist>
                    <sms>
                    <user>qdegree</user>
                    <password>7bc845dab5XX</password>
                    <message>'.$message.'</message>
                    <mobiles>'.$mobile.'</mobiles>
                    <senderid>QDSSUR</senderid>
                        <accusage>1</accusage>
                        <responsein>csv</responsein>
                    </sms>
                    </smslist>';
        $URL = "http://sms.smsmenow.in/sendsms.jsp?"; 
        $ch = curl_init($URL);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_ENCODING, 'UTF-8');
        curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/xml'));
        curl_setopt($ch, CURLOPT_POSTFIELDS, "$xml_data");
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $response = curl_exec($ch);
        //curl_close($ch);
        //$response = curl_exec($ch);        
        // print_r($response);die;
        $err = curl_error($ch);
        curl_close($ch);
        return true;
           /* if ($err) {
                $model = new \frontend\modules\nps\models\SmsLog();
                $model->details = "cURL Error #:" . $err.$response.'---'.$response_id;
                ;
                $model->status = 0;
                $model->save(false);
                //echo "cURL Error #:" . $err;
            } else {
                $model = new \frontend\modules\nps\models\SmsLog();
                $model->details = $response.'---'.$response_id;
                $model->status = 1;
                $model->save(false);
                //echo $response;
            }*/
        //print_r($output); die;
    }

    public function cluster_audit_count(){
        
        $all_cluster_clients = get_helper_cluster_clients(322);
        $all_cluster_processes = get_helper_cluster_processes(322);
        $all_cluster_partners = get_helper_cluster_partners(322);
        $all_cluster_locations = get_helper_cluster_locations(322);
        $all_cluster_lobs = get_helper_cluster_lobs(322);
        
        
        print_r($all_cluster_partners);
        die;
        if(sizeof($all_cluster_clients) > 0) { 
            $emptyArray = []; 
            $todays = date('Y-m-d');
            $all_audit_cycle = Auditcycle::whereIn('process_id',$all_cluster_processes)
                    ->where('start_date', '<=' ,$todays)
                    ->where('end_date', '>=' ,$todays)
                    ->pluck('name','id'); 
             
            foreach($all_audit_cycle as $key => $value){
                array_push($emptyArray,$key);
            }

            

            /* print_r($all_cluster_processes);
            die; */
            $target=MonthTarget::whereIn('client_id',$all_cluster_clients)
            ->whereIn('month_of_target',$emptyArray)
            ->whereIn('process_id',$all_cluster_processes)
            ->whereIn('partner_id',$all_cluster_partners)
            ->sum('eq_audit_target_mtd');
        } 
        
        
        echo $target;
        die;

        $audit_data = Audit::whereIn('client_id',$all_cluster_clients)
        ->whereDate('audit_date','>=',"2021-04-26")
        ->whereDate('audit_date','<',"2021-05-26")
        ->where('process_id',29)
        ->whereIn('partner_id',$all_cluster_partners)
        ->whereHas('raw_data', function (Builder $query) use ($all_cluster_locations,$all_cluster_lobs) {
            $query->whereIn('partner_location_id', $all_cluster_locations);
            $query->whereIn('lob', $all_cluster_lobs);
        })
        ->get();

        echo sizeof($audit_data);
    }

    public function test_mail1(){
        $to_emails = ['shailendra.kumar@qdegrees.com'];
        $corelPath = public_path() . '/weekly_reports/'."ogm.xls";
        $subject = "dkjflkdjflk";
        $client = 2;
        $process = 23;
        $qtl = "kdfjkldjf ";
        Mail::to($to_emails)->send(new WeaklyReport(
            [
            'partner_name'=>'All',
            'file'=>$corelPath,
            'subject'=>$subject,
            'client'=>$client,
            'process'=>$process,
            'qtl'=>$qtl,
            'url'=>'https://simpliq.qdegrees.com/'
            ]
        ));
    }

    public function test_mail(){
        
        $audit_cyle_data = Auditcycle::where('process_id',30)
        ->get();
        $today = date('Y-m-d');
        $current_cycle = '';
        $previous_cycle = '';
        foreach($audit_cyle_data as $value){
            if($today > $value->start_date && $today <= $value->end_date){
                $current_cycle = $value->id;
            } else{
                $previous_cycle = $value->id;
            }
        }
        
        $timestamp = strtotime($today);         
        $day = date('d', $timestamp);         
        if($day == 27 || $day >25){             
            $month = $previous_cycle;         
        }else {             
            $month = $current_cycle;         
        }
        

        $client_id = 3;
        $process_id = 30;
        $partner_id = "%";
        $lob = '%';

        $sheet_info = QmSheet::where('client_id',$client_id)->where('process_id',$process_id)->first();
        $paramter_count  = QmSheetSubParameter::where('qm_sheet_id',$sheet_info->id)->count();
        
        $final_data = DB::select("
        select p.name,c.name as client_name, w.week_number,m.*,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY) ) as achieve_first_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_first_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_first_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 1 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_first_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
            r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_second_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_second_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_second_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 2 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_second_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_third_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_third_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_third_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 3 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_third_week,


        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as achieve_fourth_week,

        (select count(a.id) from audits a inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location and a.is_critical = 1 and 
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as count_fatal_fourth_week,

        (select sum(p.score) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and a.is_critical = 0 and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scored_fourth_week,

        (select sum(p.after_audit_weight) from audit_results p inner join audits a on p.audit_id = a.id inner join raw_data r on a.raw_data_id = r.id where r.client_id = m.client_id 
        and r.partner_id = m.partner_id and r.process_id = m.process_id and r.lob like m.lob and r.location = m.location  and
        r.circle like m.circle   and w.week_number = 4 and a.audit_date >= w.start_date and a.audit_date < DATE_ADD(w.end_date, INTERVAL 1 DAY)) as total_scorable_fourth_week


        from month_targets m inner join partners p on m.partner_id = p.id 
        inner join clients c on m.client_id = c.id 
        inner join week_definitions w on m.month_of_target = w.month where m.process_id = $process_id and m.lob like '$lob%' and m.month_of_target = '$month' and m.client_id = $client_id order by p.name");
        

       /*  echo "<pre>";
        print_r($final_data);
        die; */
        $interim_data = [];  
        foreach($final_data as $value){
        if(isset($interim_data[$value->id])){
            if($value->week_number == 1){
                /* echo "hii";
                dd(); */
                
                $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
                $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
                $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
                $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
                $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;
            
            }  else if($value->week_number == 2){

                
                $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
                $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
                $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
                $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
                $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;

            } else if($value->week_number == 3){

                
                $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
                $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
                $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
                $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
                $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
                
            } else {
                
                $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
                $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
                $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
                $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
                $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
            
        }
        else {
            $interim_data[$value->id]['client_name'] = $value->client_name;
            $interim_data[$value->id]['name'] = $value->name;
            $interim_data[$value->id]['month_of_target'] = $value->month_of_target;
            $interim_data[$value->id]['lob'] = $value->lob;
            $interim_data[$value->id]['zone'] = $value->zone;
            $interim_data[$value->id]['location'] = $value->location;
            $interim_data[$value->id]['brand_name'] = $value->brand_name;
            $interim_data[$value->id]['circle'] = $value->circle;
            /* $interim_data[$value->id]['rebuttal'] = $value->rebuttal;
            $interim_data[$value->id]['rebuttal_accept'] = $value->rebuttal_accept;
            $interim_data[$value->id]['rebuttal_reject'] = $value->rebuttal_reject;
            $interim_data[$value->id]['rebuttal_process'] = $value->rebuttal_process; */

            $interim_data[$value->id]['eq_audit_target_w1'] = $value->eq_audit_target_w1;
            $interim_data[$value->id]['achieve_first_week'] = $value->achieve_first_week;
            $interim_data[$value->id]['count_fatal_first_week'] = $value->count_fatal_first_week;
            $interim_data[$value->id]['total_scored_first_week'] = $value->total_scored_first_week;
            $interim_data[$value->id]['total_scorable_first_week'] = $value->total_scorable_first_week;

            $interim_data[$value->id]['eq_audit_target_w2'] = $value->eq_audit_target_w2;
            $interim_data[$value->id]['achieve_second_week'] = $value->achieve_second_week;
            $interim_data[$value->id]['count_fatal_second_week'] = $value->count_fatal_second_week;
            $interim_data[$value->id]['total_scored_second_week'] = $value->total_scored_second_week;
            $interim_data[$value->id]['total_scorable_second_week'] = $value->total_scorable_second_week;
            
            $interim_data[$value->id]['eq_audit_target_w3'] = $value->eq_audit_target_w3;
            $interim_data[$value->id]['achieve_third_week'] = $value->achieve_third_week;
            $interim_data[$value->id]['count_fatal_third_week'] = $value->count_fatal_third_week;
            $interim_data[$value->id]['total_scored_third_week'] = $value->total_scored_third_week;
            $interim_data[$value->id]['total_scorable_third_week'] = $value->total_scorable_third_week;
            
            $interim_data[$value->id]['eq_audit_target_w4'] = $value->eq_audit_target_w4;
            $interim_data[$value->id]['achieve_fourth_week'] = $value->achieve_fourth_week;
            $interim_data[$value->id]['count_fatal_fourth_week'] = $value->count_fatal_fourth_week;
            $interim_data[$value->id]['total_scored_fourth_week'] = $value->total_scored_fourth_week;
            $interim_data[$value->id]['total_scorable_fourth_week'] = $value->total_scorable_fourth_week;
            }
        }

        $test = "<table class='table table-striped- table-bordered table-hover table-checkable'  style='border: 1px solid black;border-collapse: collapse;'>
			<thead>
                <tr align='center'>
					<th colspan='8' style='border: 1px solid black;border-collapse: collapse;'>Basic Data</th>
					
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-1</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-2</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-3</th>
                    <th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>Week-4</th>
					<th colspan='6' style='border: 1px solid black;border-collapse: collapse;'>MTD</th>
				</tr>
				<tr>
                    <th title='Field #1' style='border: 1px solid black;border-collapse: collapse;'>#</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Client</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Partner</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Lob</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'> Zone</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Location</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Brand</th>
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>Circle</th>
                    
                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

                    <th title='Field #2' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Target</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>EQ Audit Done</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'>Audit Achievement%</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> EQ Score(%)</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal Count</th>
                    <th title='Field #7' style='border: 1px solid black;border-collapse: collapse;'> Fatal%</th>

				</tr>
			</thead>
            <tbody>";
            
            $count = 1;
            $t_week1target = 0;
            $t_week2target = 0;
            $t_week3target = 0;
            $t_week4target = 0;
            $t_weekmtdtarget = 0;

            $t_week1achieve = 0;
            $t_week2achieve = 0;
            $t_week3achieve = 0;
            $t_week4achieve = 0;
            $t_weekmtdachieve = 0;

            $t_week1scored = 0;
            $t_week2scored = 0;
            $t_week3scored = 0;
            $t_week4scored = 0;
            $t_weekmtdscored = 0;

            $t_week1scorable = 0;
            $t_week2scorable = 0;
            $t_week3scorable = 0;
            $t_week4scorable = 0;
            $t_weekmtdscorable = 0;

            $t_week1fatalcount = 0;
            $t_week2fatalcount = 0;
            $t_week3fatalcount = 0;
            $t_week4fatalcount = 0;
            $t_weekmtdfatalcount = 0;

            // partner wise score
            $t_week1target_p = 0;
            $t_week2target_p = 0;
            $t_week3target_p = 0;
            $t_week4target_p = 0;
            $t_weekmtdtarget_p = 0;

            $t_week1achieve_p = 0;
            $t_week2achieve_p = 0;
            $t_week3achieve_p = 0;
            $t_week4achieve_p = 0;
            $t_weekmtdachieve_p = 0;

            $t_week1fatalcount_p = 0;
            $t_week2fatalcount_p = 0;
            $t_week3fatalcount_p = 0;
            $t_week4fatalcount_p = 0;
            $t_weekmtdfatalcount_p = 0;
            
            $t_week1scored_p = 0;
            $t_week2scored_p = 0;
            $t_week3scored_p = 0;
            $t_week4scored_p = 0;
            $t_weekmtdscored_p = 0;

            $t_week1scorable_p = 0;
            $t_week2scorable_p = 0;
            $t_week3scorable_p = 0;
            $t_week4scorable_p = 0;
            $t_weekmtdscorable_p = 0;
            
            $row_count = 0;
            $array_size = sizeof($interim_data);
            $partner_old = "";
            // partner wise socre

        foreach($interim_data as $row){
            $total_target = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];

            // partner wise total
            $row_count++;
            /* $total_target_p = $row['eq_audit_target_w1'] + $row ['eq_audit_target_w2'] + $row ['eq_audit_target_w3'] + $row ['eq_audit_target_w4'];
            $total_achievment_p = $row ['achieve_first_week'] + $row ['achieve_second_week'] + $row ['achieve_third_week'] +$row ['achieve_fourth_week'];

            $total_scored_p = $row ['total_scored_first_week'] + $row ['total_scored_second_week'] + $row ['total_scored_third_week'] + $row ['total_scored_fourth_week'];
            $total_scorable_p = $row ['total_scorable_first_week'] + $row ['total_scorable_second_week'] + $row ['total_scorable_third_week'] + $row ['total_scorable_fourth_week'];
            
            $total_count_fatal_p = $row ['count_fatal_first_week'] + $row ['count_fatal_second_week'] + $row ['count_fatal_third_week'] + $row ['count_fatal_fourth_week'];
            */
            
            $t_week1target_p = $t_week1target_p + $row ['eq_audit_target_w1'];
            $t_week2target_p = $t_week2target_p + $row ['eq_audit_target_w2'];
            $t_week3target_p = $t_week3target_p + $row ['eq_audit_target_w3'];
            $t_week4target_p = $t_week4target_p + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget_p = $t_weekmtdtarget_p + $total_target;

            $t_week1achieve_p = $t_week1achieve_p + $row ['achieve_first_week'];
            $t_week2achieve_p = $t_week2achieve_p + $row ['achieve_second_week'];
            $t_week3achieve_p = $t_week3achieve_p + $row ['achieve_third_week'];
            $t_week4achieve_p = $t_week4achieve_p + $row ['achieve_fourth_week'];
            $t_weekmtdachieve_p = $t_weekmtdachieve_p + $total_achievment;

            $t_week1fatalcount_p = $t_week1fatalcount_p + $row ['count_fatal_first_week'];
            $t_week2fatalcount_p = $t_week2fatalcount_p + $row ['count_fatal_second_week'];
            $t_week3fatalcount_p = $t_week3fatalcount_p + $row ['count_fatal_third_week'];
            $t_week4fatalcount_p = $t_week4fatalcount_p + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount_p = $t_weekmtdfatalcount_p + $total_count_fatal;
            
            $t_week1scored_p = $t_week1scored_p + $row ['total_scored_first_week'];
            $t_week2scored_p = $t_week2scored_p + $row ['total_scored_second_week'];
            $t_week3scored_p = $t_week3scored_p + $row ['total_scored_third_week'];
            $t_week4scored_p = $t_week4scored_p + $row ['total_scored_fourth_week'];
            $t_weekmtdscored_p = $t_weekmtdscored_p + $total_scored;

            $t_week1scorable_p = $t_week1scorable_p + $row ['total_scorable_first_week'];
            $t_week2scorable_p = $t_week2scorable_p + $row ['total_scorable_second_week'];
            $t_week3scorable_p = $t_week3scorable_p + $row ['total_scorable_third_week'];
            $t_week4scorable_p = $t_week4scorable_p + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable_p = $t_weekmtdscorable_p + $total_scorable;
            // Partner wise total

            $t_week1target = $t_week1target + $row ['eq_audit_target_w1'];
            $t_week2target = $t_week2target + $row ['eq_audit_target_w2'];
            $t_week3target = $t_week3target + $row ['eq_audit_target_w3'];
            $t_week4target = $t_week4target + $row ['eq_audit_target_w4'];
            $t_weekmtdtarget = $t_weekmtdtarget + $total_target;

            $t_week1achieve = $t_week1achieve + $row ['achieve_first_week'];
            $t_week2achieve = $t_week2achieve + $row ['achieve_second_week'];
            $t_week3achieve = $t_week3achieve + $row ['achieve_third_week'];
            $t_week4achieve = $t_week4achieve + $row ['achieve_fourth_week'];
            $t_weekmtdachieve = $t_weekmtdachieve + $total_achievment;

            $t_week1fatalcount = $t_week1fatalcount + $row ['count_fatal_first_week'];
            $t_week2fatalcount = $t_week2fatalcount + $row ['count_fatal_second_week'];
            $t_week3fatalcount = $t_week3fatalcount + $row ['count_fatal_third_week'];
            $t_week4fatalcount = $t_week4fatalcount + $row ['count_fatal_fourth_week'];
            $t_weekmtdfatalcount = $t_weekmtdfatalcount + $total_count_fatal;
            
            $t_week1scored = $t_week1scored + $row ['total_scored_first_week'];
            $t_week2scored = $t_week2scored + $row ['total_scored_second_week'];
            $t_week3scored = $t_week3scored + $row ['total_scored_third_week'];
            $t_week4scored = $t_week4scored + $row ['total_scored_fourth_week'];
            $t_weekmtdscored = $t_weekmtdscored + $total_scored;

            $t_week1scorable = $t_week1scorable + $row ['total_scorable_first_week'];
            $t_week2scorable = $t_week2scorable + $row ['total_scorable_second_week'];
            $t_week3scorable = $t_week3scorable + $row ['total_scorable_third_week'];
            $t_week4scorable = $t_week4scorable + $row ['total_scorable_fourth_week'];
            $t_weekmtdscorable = $t_weekmtdscorable + $total_scorable;

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 95){
                $achieve_color_w1 = "red";
            } else if(round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) >= 95 && round(divnum($row ['achieve_first_week'],$row ['eq_audit_target_w1'])*100) < 100){
                $achieve_color_w1 = "yellow";
            } else {
                $achieve_color_w1 = "green";
            }

            if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 75){
                $eq_score_color_w1 = "red";
            } else if(round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) >= 75 && round(divnum($row ['total_scored_first_week'],$row ['total_scorable_first_week'])*100) < 85){
                $eq_score_color_w1 = "yellow";
            } else {
                $eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 95){
                $achieve_color_w2 = "red";
            } else if(round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) >= 95 && round(divnum($row ['achieve_second_week'],$row ['eq_audit_target_w2'])*100) < 100){
                $achieve_color_w2 = "yellow";
            } else {
                $achieve_color_w2 = "green";
            }

            if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 75){
                $eq_score_color_w2 = "red";
            } else if(round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) >= 75 && round(divnum($row ['total_scored_second_week'],$row ['total_scorable_second_week'])*100) < 85){
                $eq_score_color_w2 = "yellow";
            } else {
                $eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 95){
                $achieve_color_w3 = "red";
            } else if(round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) >= 95 && round(divnum($row ['achieve_third_week'],$row ['eq_audit_target_w3'])*100) < 100){
                $achieve_color_w3 = "yellow";
            } else {
                $achieve_color_w3 = "green";
            }

            if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 75){
                $eq_score_color_w3 = "red";
            } else if(round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) >= 75 && round(divnum($row ['total_scored_third_week'],$row ['total_scorable_third_week'])*100) < 85){
                $eq_score_color_w3 = "yellow";
            } else {
                $eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 95){
                $achieve_color_w4 = "red";
            } else if(round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) >= 95 && round(divnum($row ['achieve_fourth_week'],$row ['eq_audit_target_w4'])*100) < 100){
                $achieve_color_w4 = "yellow";
            } else {
                $achieve_color_w4 = "green";
            }

            if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 75){
                $eq_score_color_w4 = "red";
            } else if(round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) >= 75 && round(divnum($row ['total_scored_fourth_week'],$row ['total_scorable_fourth_week'])*100) < 85){
                $eq_score_color_w4 = "yellow";
            } else {
                $eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd
            if(round(divnum($total_achievment,$total_target)*100) < 95){
                $achieve_color_mtd = "red";
            } else if(round(divnum($total_achievment,$total_target)*100) >= 95 && round(divnum($total_achievment,$total_target)*100) < 100){
                $achieve_color_mtd = "yellow";
            } else {
                $achieve_color_mtd = "green";
            }

            if(round(divnum($total_scored,$total_scorable)*100) < 75){
                $eq_score_color_mtd = "red";
            } else if(round(divnum($total_scored,$total_scorable)*100) >= 75 && round(divnum($total_scored,$total_scorable)*100) < 85){
                $eq_score_color_mtd = "yellow";
            } else {
                $eq_score_color_mtd = "green";
            }

            // end color

            // partner wise total

            // Color coding start 
            // Color coding Week 1
            if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 95){
                $pt_achieve_color_w1 = "red";
            } else if(round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) >= 95 && round(divnum(($t_week1achieve_p - $row ['achieve_first_week']),($t_week1target_p - $row ['eq_audit_target_w1']))*100) < 100){
                $pt_achieve_color_w1 = "yellow";
            } else {
                $pt_achieve_color_w1 = "green";
            }

            if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 75){
                $pt_eq_score_color_w1 = "red";
            } else if(round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) >= 75 && round(divnum(($t_week1scored_p - $row ['total_scored_first_week']),($t_week1scorable_p - $row ['total_scorable_first_week']))*100) < 85){
                $pt_eq_score_color_w1 = "yellow";
            } else {
                $pt_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 95){
                $pt_achieve_color_w2 = "red";
            } else if(round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) >= 95 && round(divnum(($t_week2achieve_p - $row ['achieve_second_week']),($t_week2target_p - $row ['eq_audit_target_w2']))*100) < 100){
                $pt_achieve_color_w2 = "yellow";
            } else {
                $pt_achieve_color_w2 = "green";
            }

            if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 75){
                $pt_eq_score_color_w2 = "red";
            } else if(round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) >= 75 && round(divnum(($t_week2scored_p - $row ['total_scored_second_week']),($t_week2scorable_p - $row ['total_scorable_second_week']))*100) < 85){
                $pt_eq_score_color_w2 = "yellow";
            } else {
                $pt_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 95){
                $pt_achieve_color_w3 = "red";
            } else if(round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) >= 95 && round(divnum(($t_week3achieve_p - $row ['achieve_third_week']),($t_week3target_p - $row ['eq_audit_target_w3']))*100) < 100){
                $pt_achieve_color_w3 = "yellow";
            } else {
                $pt_achieve_color_w3 = "green";
            }

            if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 75){
                $pt_eq_score_color_w3 = "red";
            } else if(round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) >= 75 && round(divnum(($t_week3scored_p - $row ['total_scored_third_week']),($t_week3scorable_p - $row ['total_scorable_third_week']))*100) < 85){
                $pt_eq_score_color_w3 = "yellow";
            } else {
                $pt_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 95){
                $pt_achieve_color_w4 = "red";
            } else if(round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) >= 95 && round(divnum(($t_week4achieve_p - $row ['achieve_fourth_week']),($t_week4target_p - $row ['eq_audit_target_w4']))*100) < 100){
                $pt_achieve_color_w4 = "yellow";
            } else {
                $pt_achieve_color_w4 = "green";
            }

            if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 75){
                $pt_eq_score_color_w4 = "red";
            } else if(round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) >= 75 && round(divnum(($t_week4scored_p - $row ['total_scored_fourth_week']),($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100) < 85){
                $pt_eq_score_color_w4 = "yellow";
            } else {
                $pt_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 95){
                $pt_achieve_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) >= 95 && round(divnum(($t_weekmtdachieve_p - $total_achievment),($t_weekmtdtarget_p - $total_target))*100) < 100){
                $pt_achieve_color_mtd = "yellow";
            } else {
                $pt_achieve_color_mtd = "green";
            }

            if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 75){
                $pt_eq_score_color_mtd = "red";
            } else if(round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) >= 75 && round(divnum(($t_weekmtdscored_p - $total_scored),($t_weekmtdscorable_p - $total_scorable))*100) < 85){
                $pt_eq_score_color_mtd = "yellow";
            } else {
                $pt_eq_score_color_mtd = "green";
            }

            // end color

            // Color coding start 
            // Color coding Week 1
            if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 95){
                $ptl_achieve_color_w1 = "red";
            } else if(round(divnum($t_week1achieve_p,$t_week1target_p)*100) >= 95 && round(divnum($t_week1achieve_p,$t_week1target_p)*100) < 100){
                $ptl_achieve_color_w1 = "yellow";
            } else {
                $ptl_achieve_color_w1 = "green";
            }

            if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 75){
                $ptl_eq_score_color_w1 = "red";
            } else if(round(divnum($t_week1scored_p,$t_week1scorable_p)*100) >= 75 && round(divnum($t_week1scored_p,$t_week1scorable_p)*100) < 85){
                $ptl_eq_score_color_w1 = "yellow";
            } else {
                $ptl_eq_score_color_w1 = "green";
            }

            // Color coding Week 2
            if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 95){
                $ptl_achieve_color_w2 = "red";
            } else if(round(divnum($t_week2achieve_p,$t_week2target_p)*100) >= 95 && round(divnum($t_week2achieve_p,$t_week2target_p)*100) < 100){
                $ptl_achieve_color_w2 = "yellow";
            } else {
                $ptl_achieve_color_w2 = "green";
            }

            if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 75){
                $ptl_eq_score_color_w2 = "red";
            } else if(round(divnum($t_week2scored_p,$t_week2scorable_p)*100) >= 75 && round(divnum($t_week2scored_p,$t_week2scorable_p)*100) < 85){
                $ptl_eq_score_color_w2 = "yellow";
            } else {
                $ptl_eq_score_color_w2 = "green";
            }
            // Color coding Week 3
            if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 95){
                $ptl_achieve_color_w3 = "red";
            } else if(round(divnum($t_week3achieve_p,$t_week3target_p)*100) >= 95 && round(divnum($t_week3achieve_p,$t_week3target_p)*100) < 100){
                $ptl_achieve_color_w3 = "yellow";
            } else {
                $ptl_achieve_color_w3 = "green";
            }

            if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 75){
                $ptl_eq_score_color_w3 = "red";
            } else if(round(divnum($t_week3scored_p,$t_week3scorable_p)*100) >= 75 && round(divnum($t_week3scored_p,$t_week3scorable_p)*100) < 85){
                $ptl_eq_score_color_w3 = "yellow";
            } else {
                $ptl_eq_score_color_w3 = "green";
            }
            // Color coding Week 4
            if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 95){
                $ptl_achieve_color_w4 = "red";
            } else if(round(divnum($t_week4achieve_p,$t_week4target_p)*100) >= 95 && round(divnum($t_week4achieve_p,$t_week4target_p)*100) < 100){
                $ptl_achieve_color_w4 = "yellow";
            } else {
                $ptl_achieve_color_w4 = "green";
            }

            if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 75){
                $ptl_eq_score_color_w4 = "red";
            } else if(round(divnum($t_week4scored_p,$t_week4scorable_p)*100) >= 75 && round(divnum($t_week4scored_p,$t_week4scorable_p)*100) < 85){
                $ptl_eq_score_color_w4 = "yellow";
            } else {
                $ptl_eq_score_color_w4 = "green";
            }
            
            // Color coding Week mtd

            
            if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 95){
                $ptl_achieve_color_mtd = "red";
            } else if(round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) >= 95 && round(divnum($t_weekmtdachieve_p,$t_weekmtdtarget_p)*100) < 100){
                $ptl_achieve_color_mtd = "yellow";
            } else {
                $ptl_achieve_color_mtd = "green";
            }

            if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 75){
                $ptl_eq_score_color_mtd = "red";
            } else if(round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) >= 75 && round(divnum($t_weekmtdscored_p,$t_weekmtdscorable_p)*100) < 85){
                $ptl_eq_score_color_mtd = "yellow";
            } else {
                $ptl_eq_score_color_mtd = "green";
            }

            // end color

            // Partner wise total

            // Partner wise total
            $partner_new = $row ['name'];
            if($partner_old == ""){
                $partner_old = $row ['name'];
            }

            if($partner_old != $partner_new ){

                
                $test .= "<tr>
                <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$partner_old."</th>
                

                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1target_p - $row ['eq_audit_target_w1'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1achieve_p - $row ['achieve_first_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w1."'>";
                
                    if(($t_week1target_p - $row ['eq_audit_target_w1']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1achieve_p - $row ['achieve_first_week'])/($t_week1target_p - $row ['eq_audit_target_w1']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w1."'>";
                
                    if(($t_week1scorable_p - $row ['total_scorable_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1scored_p - $row ['total_scored_first_week'])/($t_week1scorable_p - $row ['total_scorable_first_week']))*100) . "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week1fatalcount_p - $row ['count_fatal_first_week'])."</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week1achieve_p - $row ['achieve_first_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week1fatalcount_p - $row ['count_fatal_first_week'])/($t_week1achieve_p - $row ['achieve_first_week']))*100). "%";
                
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2target_p - $row ['eq_audit_target_w2'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2achieve_p - $row ['achieve_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w2."'>";
                    if(($t_week2target_p - $row ['eq_audit_target_w2']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2achieve_p - $row ['achieve_second_week'])/($t_week2target_p - $row ['eq_audit_target_w2']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w2."'>";
                    if(($t_week2scorable_p - $row ['total_scorable_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2scored_p - $row ['total_scored_second_week'])/($t_week2scorable_p - $row ['total_scorable_second_week']))*100). "%";
                    
                    $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week2fatalcount_p - $row ['count_fatal_second_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week2achieve_p - $row ['achieve_second_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week2fatalcount_p - $row ['count_fatal_second_week'])/($t_week2achieve_p - $row ['achieve_second_week']))*100). "%";
                    
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3target_p -$row ['eq_audit_target_w3'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3achieve_p - $row ['achieve_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w3."'>";
                    if(($t_week3target_p -$row ['eq_audit_target_w3']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3achieve_p - $row ['achieve_third_week'])/($t_week3target_p -$row ['eq_audit_target_w3']))*100). "%";
                    
                $test .= "</td>
                        <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w3."'>";
                    if(($t_week3scorable_p - $row ['total_scorable_third_week']) == 0)
                        $test .= "0 %";
                    else 
                    $test .= round((($t_week3scored_p - $row ['total_scored_third_week'])/($t_week3scorable_p - $row ['total_scorable_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week3fatalcount_p - $row ['count_fatal_third_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week3achieve_p - $row ['achieve_third_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week3fatalcount_p - $row ['count_fatal_third_week'])/($t_week3achieve_p - $row ['achieve_third_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4target_p - $row ['eq_audit_target_w4'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4achieve_p - $row ['achieve_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_w4."'>";
                    if(($t_week4target_p - $row ['eq_audit_target_w4']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4achieve_p - $row ['achieve_fourth_week'])/($t_week4target_p - $row ['eq_audit_target_w4']))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_w4."'>";
                    if(($t_week4scorable_p - $row ['total_scorable_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4scored_p - $row ['total_scored_fourth_week'])/($t_week4scorable_p - $row ['total_scorable_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_week4achieve_p - $row ['achieve_fourth_week']) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_week4fatalcount_p - $row ['count_fatal_fourth_week'])/($t_week4achieve_p - $row ['achieve_fourth_week']))*100). "%";
                    
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdtarget_p - $total_target)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdachieve_p - $total_achievment)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_achieve_color_mtd."'>";
                    if(($t_weekmtdtarget_p - $total_target) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdachieve_p - $total_achievment)/($t_weekmtdtarget_p - $total_target))*100). "%";
                
                $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$pt_eq_score_color_mtd."'>";
                    if(($t_weekmtdscorable_p - $total_scorable) == 0)
                        $test .= "0 %";
                    else 
                        $test .= round((($t_weekmtdscored_p - $total_scored)/($t_weekmtdscorable_p - $total_scorable))*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".($t_weekmtdfatalcount_p - $total_count_fatal)."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                    if(($t_weekmtdachieve_p - $total_achievment) == 0)
                        $test .= "0 %";
                    else
                        $test .= round((($t_weekmtdfatalcount_p - $total_count_fatal)/($t_weekmtdachieve_p - $total_achievment))*100). "%";
                    
                $test .= "</td>

                </tr>";

                $t_week1target_p = $row ['eq_audit_target_w1'];
                
                $t_week2target_p = $row ['eq_audit_target_w2'];
                $t_week3target_p = $row ['eq_audit_target_w3'];
                $t_week4target_p = $row ['eq_audit_target_w4'];
                $t_weekmtdtarget_p = $total_target;

                $t_week1achieve_p = $row ['achieve_first_week'];
                $t_week2achieve_p =  $row ['achieve_second_week'];
                $t_week3achieve_p = $row ['achieve_third_week'];
                $t_week4achieve_p = $row ['achieve_fourth_week'];
                $t_weekmtdachieve_p = $total_achievment;

                $t_week1fatalcount_p = $row ['count_fatal_first_week'];
                $t_week2fatalcount_p = $row ['count_fatal_second_week'];
                $t_week3fatalcount_p = $row ['count_fatal_third_week'];
                $t_week4fatalcount_p = $row ['count_fatal_fourth_week'];
                $t_weekmtdfatalcount_p = $total_count_fatal;
                
                $t_week1scored_p = $row ['total_scored_first_week'];
                $t_week2scored_p = $row ['total_scored_second_week'];
                $t_week3scored_p = $row ['total_scored_third_week'];
                $t_week4scored_p = $row ['total_scored_fourth_week'];
                $t_weekmtdscored_p = $total_scored;

                $t_week1scorable_p = $row ['total_scorable_first_week'];
                $t_week2scorable_p = $row ['total_scorable_second_week'];
                $t_week3scorable_p = $row ['total_scorable_third_week'];
                $t_week4scorable_p = $row ['total_scorable_fourth_week'];
                $t_weekmtdscorable_p = $total_scorable;
            }

            // Partner wise total

            $test .= "<tr>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$count."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['client_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['name']."</td>
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['lob']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['zone']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['location']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['brand_name']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['circle']."</td>
            

            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w1']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_first_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w1."'>";
            
                if($row ['eq_audit_target_w1'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_first_week']/$row ['eq_audit_target_w1'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w1."'>";
            
                if($row ['total_scorable_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_first_week']/$row ['total_scorable_first_week'])*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_first_week']."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_first_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_first_week']/$row ['achieve_first_week'])*100). "%";
               
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w2']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w2."'>";
                if($row ['eq_audit_target_w2'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['achieve_second_week']/$row ['eq_audit_target_w2'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w2."'>";
                if($row ['total_scorable_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_second_week']/$row ['total_scorable_second_week'])*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_second_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_second_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['count_fatal_second_week']/$row ['achieve_second_week'])*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w3']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w3."'>";
                if($row ['eq_audit_target_w3'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_third_week']/$row ['eq_audit_target_w3'])*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w3."'>";
                if($row ['total_scorable_third_week'] == 0)
                    $test .= "0 %";
                else 
                $test .= round(($row ['total_scored_third_week']/$row ['total_scorable_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_third_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_third_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_third_week']/$row ['achieve_third_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['eq_audit_target_w4']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['achieve_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_w4."'>";
                if($row ['eq_audit_target_w4'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['achieve_fourth_week']/$row ['eq_audit_target_w4'])*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_w4."'>";
                if($row ['total_scorable_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['total_scored_fourth_week']/$row ['total_scorable_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$row ['count_fatal_fourth_week']."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($row ['achieve_fourth_week'] == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($row ['count_fatal_fourth_week']/$row ['achieve_fourth_week'])*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$total_target."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_achievment."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$achieve_color_mtd."'>";
                if($total_target == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_achievment/$total_target)*100). "%";
               
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$eq_score_color_mtd."'>";
                if($total_scorable == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($total_scored/$total_scorable)*100). "%";
               
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$total_count_fatal."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($total_achievment == 0)
                    $test .= "0 %";
                else
                    $test .= round(($total_count_fatal/$total_achievment)*100). "%";
                
            $test .= "</td>

        </tr>";

        // partner wise score


        if($row_count == $array_size){

            $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>".$row ['name']."</th>
            
            
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w1."'>";
            
                if($t_week1target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1achieve_p/$t_week1target_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w1."'>";
            
                if($t_week1scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1scored_p/$t_week1scorable_p)*100) . "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week1fatalcount_p."</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week1achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week1fatalcount_p/$t_week1achieve_p)*100). "%";
            
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w2."'>";
                if($t_week2target_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2achieve_p/$t_week2target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w2."'>";
                if($t_week2scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2scored_p/$t_week2scorable_p)*100). "%";
                
                $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week2fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week2achieve_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week2fatalcount_p/$t_week2achieve_p)*100). "%";
                
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w3."'>";
                if($t_week3target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3achieve_p/$t_week3target_p)*100). "%";
                
            $test .= "</td>
                    <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w3."'>";
                if($t_week3scorable_p == 0)
                    $test .= "0 %";
                else 
                $test .= round(($t_week3scored_p/$t_week3scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week3fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week3achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week3fatalcount_p/$t_week3achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4target_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4achieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_w4."'>";
                if($t_week4target_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4achieve_p/$t_week4target_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_w4."'>";
                if($t_week4scorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4scored_p/$t_week4scorable_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_week4fatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_week4achieve_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_week4fatalcount_p/$t_week4achieve_p)*100). "%";
                
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdtarget_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdachieve_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_achieve_color_mtd."'>";
                if($t_weekmtdtarget_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdachieve_p/$t_weekmtdtarget_p)*100). "%";
            
            $test .= "</td>
                <td style='border: 1px solid black;border-collapse: collapse;' bgcolor='".$ptl_eq_score_color_mtd."'>";
                if($t_weekmtdscorable_p == 0)
                    $test .= "0 %";
                else 
                    $test .= round(($t_weekmtdscored_p/$t_weekmtdscorable_p)*100). "%";
            
            $test .= "</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>".$t_weekmtdfatalcount_p."</td>
            <td style='border: 1px solid black;border-collapse: collapse;'>";
                if($t_weekmtdachieve_p == 0)
                    $test .= "0 %";
                else
                    $test .= round(($t_weekmtdfatalcount_p/$t_weekmtdachieve_p)*100). "%";
                
            $test .= "</td>

            </tr>";

            
        }

        $partner_old = $row ['name'];
        // Partner wise score

        $count ++;
        }   
        // Color coding start 
        // Color coding Week 1
        if(round(divnum($t_week1achieve,$t_week1target)*100) < 95){
            $total_achieve_color_w1 = "red";
        } else if(round(divnum($t_week1achieve,$t_week1target)*100) >= 95 && round(divnum($t_week1achieve,$t_week1target)*100) < 100){
            $total_achieve_color_w1 = "yellow";
        } else {
            $total_achieve_color_w1 = "green";
        }

        if(round(divnum($t_week1scored,$t_week1scorable)*100) < 75){
            $total_eq_score_color_w1 = "red";
        } else if(round(divnum($t_week1scored,$t_week1scorable)*100) >= 75 && round(divnum($t_week1scored,$t_week1scorable)*100) < 85){
            $total_eq_score_color_w1 = "yellow";
        } else {
            $total_eq_score_color_w1 = "green";
        }

        // Color coding Week 2
        if(round(divnum($t_week2achieve,$t_week2target)*100) < 95){
            $total_achieve_color_w2 = "red";
        } else if(round(divnum($t_week2achieve,$t_week2target)*100) >= 95 && round(divnum($t_week2achieve,$t_week2target)*100) < 100){
            $total_achieve_color_w2 = "yellow";
        } else {
            $total_achieve_color_w2 = "green";
        }

        if(round(divnum($t_week2scored,$t_week2scorable)*100) < 75){
            $total_eq_score_color_w2 = "red";
        } else if(round(divnum($t_week2scored,$t_week2scorable)*100) >= 75 && round(divnum($t_week2scored,$t_week2scorable)*100) < 85){
            $total_eq_score_color_w2 = "yellow";
        } else {
            $total_eq_score_color_w2 = "green";
        }
        // Color coding Week 3
        if(round(divnum($t_week3achieve,$t_week3target)*100) < 95){
            $total_achieve_color_w3 = "red";
        } else if(round(divnum($t_week3achieve,$t_week3target)*100) >= 95 && round(divnum($t_week3achieve,$t_week3target)*100) < 100){
            $total_achieve_color_w3 = "yellow";
        } else {
            $total_achieve_color_w3 = "green";
        }

        if(round(divnum($t_week3scored,$t_week3scorable)*100) < 75){
            $total_eq_score_color_w3 = "red";
        } else if(round(divnum($t_week3scored,$t_week3scorable)*100) >= 75 && round(divnum($t_week3scored,$t_week3scorable)*100) < 85){
            $total_eq_score_color_w3 = "yellow";
        } else {
            $total_eq_score_color_w3 = "green";
        }
        // Color coding Week 4
        if(round(divnum($t_week4achieve,$t_week4target)*100) < 95){
            $total_achieve_color_w4 = "red";
        } else if(round(divnum($t_week4achieve,$t_week4target)*100) >= 95 && round(divnum($t_week4achieve,$t_week4target)*100) < 100){
            $total_achieve_color_w4 = "yellow";
        } else {
            $total_achieve_color_w4 = "green";
        }

        if(round(divnum($t_week4scored,$t_week4scorable)*100) < 75){
            $total_eq_score_color_w4 = "red";
        } else if(round(divnum($t_week4scored,$t_week4scorable)*100) >= 75 && round(divnum($t_week4scored,$t_week4scorable)*100) < 85){
            $total_eq_score_color_w4 = "yellow";
        } else {
            $total_eq_score_color_w4 = "green";
        }
        
        // Color coding Week mtd
        if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 95){
            $total_achieve_color_mtd = "red";
        } else if(round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) >= 95 && round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100) < 100){
            $total_achieve_color_mtd = "yellow";
        } else {
            $total_achieve_color_mtd = "green";
        }

        if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 75){
            $total_eq_score_color_mtd = "red";
        } else if(round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) >= 75 && round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) < 85){
            $total_eq_score_color_mtd = "yellow";
        } else {
            $total_eq_score_color_mtd = "green";
        }
         
        $test .= "<tr>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='8'>Total</th>
            
            
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week1achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w1."'>".round(divnum($t_week1achieve,$t_week1target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w1."'>".round(divnum($t_week1scored,$t_week1scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week1fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week1fatalcount,$t_week1achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week2achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w2."'>".round(divnum($t_week2achieve,$t_week2target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w2."'>".round(divnum($t_week2scored,$t_week2scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week2fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week2fatalcount,$t_week2achieve)*100)."%</th>


            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week3achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w3."'>".round(divnum($t_week3achieve,$t_week3target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w3."'>".round(divnum($t_week3scored,$t_week3scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week3fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week3fatalcount,$t_week3achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4target."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_week4achieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_w4."'>".round(divnum($t_week4achieve,$t_week4target)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_w4."'>".round(divnum($t_week4scored,$t_week4scorable)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_week4fatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".round(divnum($t_week4fatalcount,$t_week4achieve)*100)."%</th>

            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdtarget."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'>".$t_weekmtdachieve."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_achieve_color_mtd."'>".round(divnum($t_weekmtdachieve,$t_weekmtdtarget)*100)."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1' bgcolor='".$total_eq_score_color_mtd."'> ".round(divnum($t_weekmtdscored,$t_weekmtdscorable)*100) ."%</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".$t_weekmtdfatalcount."</th>
            <th style='border: 1px solid black;border-collapse: collapse;' colspan='1'> ".round(divnum($t_weekmtdfatalcount,$t_weekmtdachieve)*100)."%</th>
        </tr>";
        
        $test .= "</tbody>
        </table>";

        //$test="<table  ><tr><td bgcolor='green'>Cell 1</td><td style='border: 1px solid black;border-collapse: collapse;'>Cell 2</td></tr></table>";
        
        
        require_once('HtmlConvert2021.php');
        $xls = new \HtmlExcel();
        $xls->addSheet("weekly_report", $test); 
        
        //$xls->headers();
        $ddddd = $xls->buildFile();
        $files=file_put_contents("Weekly_report.xls", $ddddd);

            $to_emails = ['shailendra.kumar@qdegrees.com'];
            $corelPath = $files;
            $subject = "dkjflkdjflk";
            $client = 2;
            $process = 23;
            $qtl = "kdfjkldjf ";
            Mail::to($to_emails)->send(new WeaklyReport(
                [
                'partner_name'=>'All',
                'file'=>'Weekly_report.xls',
                'subject'=>$subject,
                'client'=>$client,
                'process'=>$process,
                'qtl'=>$qtl,
                'url'=>'https://simpliq.qdegrees.com/'
                ]
            ));
        
        /* $file="ogml2.xls";
        
        header("Content-type: application/vnd.ms-excel");
        header("Content-Disposition: attachment; filename=$file");
        echo $test; */
        die;

            
        
    }
    public function fileUpload(Request $request){
        if(isset($request->file_upload)){
            $request->file_upload->store("test_folder");

            $file_name = $request->file_upload->hashName();

            $url = Storage::disk('s3')->temporaryUrl (
                "test_folder/" .$file_name,
                now()->addMinutes(8640) //Minutes for which the signature will stay valid
                );
           echo $url; die;
        }else{
            echo "unsuccessful";
            return view('test_upload');
        }
       
    }
    public function code_testing(){


	echo "<table style='width:100%'>
      <tr>
        <th>Company</th>
        <th>Contact</th>
        <th>Country</th>
      </tr>
      <tr>
        <td>Alfreds Futterkiste</td>
        <td>Maria Anders</td>
        <td>Germany</td>
      </tr>
      <tr>
        <td>Centro comercial Moctezuma</td>
        <td>Francisco Chang</td>
        <td>Mexico</td>
      </tr>
    </table>";
    die;




        echo 'display_errors = ' . ini_get('display_errors') . "<br>";
        
        echo 'post_max_size = ' . ini_get('post_max_size') . "<br>";
        echo 'upload_max_filesize = ' . (ini_get('upload_max_filesize')) . "<br>";
        echo 'max_file_uploads = ' . (ini_get('max_file_uploads')) . "<br>";
        //echo 'max_file_upload = ' . (ini_get('max_file_upload')) . "<br>";
    }
}
